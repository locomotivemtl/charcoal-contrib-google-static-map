<?php

namespace Charcoal\GoogleStaticMap\Service;

/**
 * Provides tools to generate google static map compatible urls from provided map data.
 * The service is configurable.
 * It can also output a rendered image of the desired map.
 *
 * Static Map Generator Service
 */
class StaticMapGeneratorService
{
    private $geomerties = [];

    /**
     * @var PolylineOptimizerService
     */
    private $polylineOptimizer;

    /**
     * @var \Polyline
     */
    private $polylineEncoder;

    /**
     * StaticMapGeneratorService constructor.
     * @param array $data Init data.
     */
    public function __construct(array $data = [])
    {
        $this->setPolylineOptimizer($data['polyline/optimizer']);
        $this->setPolylineEncoder($data['polyline/encoder']);
    }

    public function process()
    {
        $test = '48.942636027742,-72.0748106925435 48.9424602583078,-72.0751496432197 48.9422841630434,-72.0754550152693 48.9417836852799,-72.0764385898511 48.9416260722419,-72.0767843849046 48.9411517119944,-72.0776989291314 48.9409761146075,-72.078045226776 48.9404756141576,-72.079028749937 48.9403178250419,-72.0793608805422 48.9397820240571,-72.0803999865502 48.9391413517475,-72.0816877746052 48.9390712758213,-72.0818399298378 48.9389749001129,-72.082047436718 48.9388693659947,-72.0822415505201 48.9383774837493,-72.0831974424879 48.937824671892,-72.0843188561149 48.9376935029842,-72.0846228966184 48.9372793325542,-72.0853171721506 48.9263295848644,-72.1078323072627 48.9262591442055,-72.1079570999731 48.9246532195466,-72.1112635700597 48.9245590893208,-72.1116619661915 48.9243475899493,-72.1120226708061 48.92407611141,-72.1126306920325 48.9239532000832,-72.1128797543774 48.9238399349102,-72.1131831386597 48.9236746948453,-72.1136517310761 48.9234917999561,-72.1141481039481 48.9233249167956,-72.1144802609297 48.9231308975537,-72.114799518906 48.9229275593032,-72.1150917374391 48.9227775074853,-72.1153278910826 48.922567142701,-72.1157840663986 48.9221195999973,-72.1167107931924 48.9219793532783,-72.1170149026629 48.9215144736018,-72.1179966736191 48.9213743868719,-72.1183144182443 48.9211285385018,-72.1188124871766 48.9208826879256,-72.1193105512384 48.9208125611584,-72.1194625988249 48.9207424341859,-72.1196146459877 48.9205408792168,-72.1200568950376 48.9203303320796,-72.1204993881855 48.9202863590811,-72.1205824790505 48.9202422228409,-72.1206519276696 48.9201359693626,-72.1207913197114 48.9199499437848,-72.121028433347 48.9197639176974,-72.1212655452168 48.9196306921331,-72.1214056770321 48.91958622921,-72.1214478401619 48.9195327758328,-72.1214902506709 48.9195061306764,-72.1215182768436 48.9193998761021,-72.1216576649877 48.919293621352,-72.1217970525392 48.9187278497626,-72.122617745765 48.9185336443791,-72.1229233013586 48.9184896695741,-72.123006387118 48.9183221087385,-72.1232839152171 48.9182779708102,-72.1233533587294 48.9181190739101,-72.1236033543607 48.9179779945496,-72.1238392128706 48.9178284125445,-72.1241162414175 48.9173437006064,-72.1249483044177 48.9170610478782,-72.1253790814703 48.9168143553162,-72.1258088670385 48.9165861295507,-72.1262790786379 48.9162702713339,-72.1269427255512 48.9158579491038,-72.1278136879083 48.9153753184734,-72.1288230132245 48.9151210815413,-72.1293757802804 48.914831204128,-72.1299568067114 48.9144541726366,-72.1307721741925 48.9141642880111,-72.1313531848725 48.9137954278604,-72.132100083546 48.9135143651195,-72.1326671932288 48.9132421283336,-72.1332204110141 48.9129085713958,-72.1339117409478 48.9127679550346,-72.1341884664485 48.9121353343884,-72.1354473520222 48.9116521514152,-72.1364156098669 48.9114941929113,-72.1367473700044 48.9111955077256,-72.1373472430177 48.8996580642642,-72.1244125631041 48.899634259693,-72.1244601414205 48.8880641126117,-72.1110242427357 48.8753727248065,-72.1364204165664 48.8750036627434,-72.1371530650268 48.8739669247231,-72.1392263285194 48.8600560246512,-72.1671092616982 48.8481869668401,-72.1539501607638 48.8469365257363,-72.1564336131255 48.8468395333927,-72.1565997276024 48.8467611570912,-72.1568198497581 48.8467438106199,-72.1568748200687 48.8467264641221,-72.1569297903417 48.8466304231825,-72.1571776369704 48.8464194065175,-72.1575920746148 48.8463490672894,-72.1577302197249 48.8460853729497,-72.1582550715319 48.8456893514515,-72.159001472779 48.8453821232664,-72.159650108842 48.8452065852466,-72.1600227004634 48.8448198592132,-72.1607960786829 48.8445998385023,-72.1612107259806 48.8443884906534,-72.1615978866045 48.8441601086899,-72.1620672530219 48.8439755719563,-72.1624400666662 48.8436593332374,-72.1630888990831 48.8432117034939,-72.1640409828192 48.8431235327561,-72.1641932098238 48.8429569704123,-72.1645655298649 48.8429129636103,-72.1646484532566 48.8426318864433,-72.1652281960692 48.8425967121585,-72.1652972581535 48.8422446517062,-72.1659606313751 48.8413114836308,-72.1677021804627 48.8389804848569,-72.1722328348389 48.8381626891638,-72.1738484884058 48.8358143978968,-72.1784607654199 48.8343889307174,-72.1812092834344 48.8338258242412,-72.1823002870616 48.8320573042147,-72.1802215518815 48.8281268232574,-72.1754891579998 48.8269874769619,-72.1741706916371 48.8265957038773,-72.1737315324909 48.825939591402,-72.1729860781002 48.8225228390401,-72.1691537413619 48.8224591175911,-72.1690873288902 48.822393823745,-72.1688847586234 48.8194588085243,-72.1655032222556 48.8164970399497,-72.1621500255535 48.8163609160123,-72.1624245170593 48.8146609853326,-72.1604830379505 48.8104685031836,-72.1557199478937 48.8078803273191,-72.1528072312089 48.8051089162463,-72.1496138096261 48.8023928014235,-72.1465417791308 48.7994035208882,-72.1431915556073 48.7963041685871,-72.1396677344892 48.7933048967272,-72.1362505266596 48.7900955112465,-72.1325672066363 48.7874980958825,-72.1296843083661 48.7869039560031,-72.1290093534068 48.7853100530787,-72.1271988318992 48.7824462543078,-72.1238610485698 48.7793652824359,-72.1204207265258 48.7764841265865,-72.1171522295526 48.7734296035123,-72.1136847749714 48.7702469769211,-72.1100443961875 48.767648517565,-72.1071229851648 48.7647766427322,-72.1039101536978 48.7615021562227,-72.1001375225115 48.7613015541243,-72.0999118391054 48.7609603073639,-72.0992139493866 48.7607162989435,-72.0983773300444 48.7603041630872,-72.0970284783475 48.7602005089152,-72.0959023015127 48.7601534405388,-72.0949922012261 48.7600460854568,-72.0943014357175 48.7600326150862,-72.0939345269084 48.7600479671144,-72.092981878253 48.7600483208108,-72.0922745048499 48.760174039522,-72.0915228161699 48.7602857725924,-72.0903634187032 48.7604138100037,-72.0890675268465 48.7604464262908,-72.087325396423 48.7604254067664,-72.0856119763353 48.7603118153633,-72.0844180827533 48.7601166279445,-72.0831720770591 48.7598295587643,-72.0824999977927 48.7596264129022,-72.08207041781 48.7592984022611,-72.0817259751966 48.7590085290597,-72.0815573002109 48.7561621103706,-72.0787241550338 48.7559375649498,-72.0797109259182 48.7556597512312,-72.0807108864735 48.7539654437425,-72.0848500914659 48.7531322872752,-72.0868225589779 48.7514380406979,-72.0903229231499 48.7501049150109,-72.0927953850238 48.7490218513603,-72.0957401491173 48.7484386087392,-72.0972681805687 48.7477721220075,-72.0995184659206 48.7471333380435,-72.1010464611087 48.7465223277282,-72.1021298958478 48.7460501760825,-72.1027688359375 48.7441891549115,-72.1043524818636 48.7424671582825,-72.1058250082891 48.7413560711005,-72.1065750826712 48.7400506688339,-72.1073808042207 48.7394118577569,-72.1084087531858 48.7387452787963,-72.1099088630761 48.7383009047957,-72.1115201558868 48.7376622876523,-72.1157150434921 48.7376067037565,-72.1161040863977 48.7367180484935,-72.1197710734304 48.7362182260898,-72.1220214143556 48.7359405076656,-72.1235492433201 48.735357390759,-72.1276608250719 48.7351075188626,-72.129577647394 48.734968810425,-72.1322167977372 48.7349133197511,-72.1350226819832 48.7349690261335,-72.1367727903204 48.7350803755683,-72.1420511527907 48.7353306393782,-72.1464126733127 48.7358586154894,-72.1513019641817 48.7360809849676,-72.1537744083826 48.7360811290897,-72.1553578678401 48.7357757511638,-72.1595527971706 48.7357479907205,-72.1598027598179 48.7355815057768,-72.1627196897171 48.7353594011965,-72.1648865976664 48.734664979868,-72.1699701307567 48.7343594414148,-72.1725258385931 48.7341649336572,-72.1736368669368 48.7332760727141,-72.1779702744151 48.7326927127963,-72.1816092324201 48.7325260785809,-72.1826093352764 48.7322482809127,-72.1852482892273 48.7320538366596,-72.187109420109 48.7316926429047,-72.1894705614607 48.731387101584,-72.1912483443048 48.7309704552971,-72.1926371711607 48.7301370732672,-72.1941649698043 48.7286370630111,-72.1956372302436 48.7278592790033,-72.1965260305656 48.7261091439237,-72.1998316317736 48.7249147082593,-72.2020259811888 48.7240535637458,-72.2038870531824 48.7224145634928,-72.2086926719863 48.7215256538284,-72.2118036837615 48.7213034667796,-72.2123870442012 48.7211645838069,-72.2128036677971 48.7197756385125,-72.2157481137534 48.7190255398881,-72.217747971743 48.7185254914407,-72.2194701300778 48.7172754724855,-72.223109049108 48.71644209345,-72.2251367610537 48.7159143065095,-72.2261088181481 48.715803204585,-72.2262199448624 48.7147475415863,-72.2273032861999 48.7138030686951,-72.2285531176251 48.7115807278524,-72.23191406616 48.7096917533106,-72.2346916621049 48.7091639267261,-72.2355527353681 48.7086639679419,-72.2365526534924 48.7081361412167,-72.2378581868495 48.7070805167307,-72.2391358420572 48.7064693716908,-72.2397745563109 48.7053859583715,-72.2409967019949 48.7046914853406,-72.2422744599543 48.7037747290881,-72.2440520426504 48.7031080602221,-72.2458297318307 48.7027191381908,-72.2464130637228 48.7021080042815,-72.2469407598484 48.700996858474,-72.2475794935932 48.698691148369,-72.2492180336504 48.6970799213209,-72.250551212602 48.69599650675,-72.2516344561283 48.6948019936312,-72.2531066314169 48.6939130563936,-72.2541620121757 48.6934130223299,-72.2548287436482 48.6922741082476,-72.2569396464395 48.6913851778564,-72.2592173759302 48.6903573030915,-72.2623284294407 48.6895794870984,-72.2654673374607 48.6892183328369,-72.2665785027602 48.6887460677218,-72.2676618000964 48.6879682318483,-72.2688838809764 48.6865793751657,-72.270689398382 48.6849403663594,-72.2727725511363 48.6844681565116,-72.2734948055247 48.6833014930145,-72.2760225576747 48.6827736933108,-72.277355808438 48.6819680656087,-72.2799113351496 48.6815513709349,-72.2810224817065 48.6807736224287,-72.2823002698416 48.6784124615433,-72.2853278986117 48.677190245578,-72.2871055276604 48.6759124362882,-72.2896889015432 48.6753568651886,-72.2911332909717 48.6745791776219,-72.2935776896593 48.6739402910903,-72.2955222275035 48.6731347284834,-72.2976055281629 48.6727180900912,-72.2991610583002 48.6724402787843,-72.3004388278734 48.6722458706207,-72.3015221860542 48.6721347574832,-72.3027722168322 48.6720791867008,-72.306022378919 48.6719959032185,-72.307411197521 48.672162530292,-72.3099391269646 48.6722736763725,-72.3125780978374 48.6724402982022,-72.314050396616 48.6728569566918,-72.3155782225559 48.6738570013665,-72.317244915434 48.6746624885074,-72.3185783523822 48.6760208147077,-72.3201326353177 48.6778291262611,-72.3219119964282 48.6794956877291,-72.323217674502 48.680745649044,-72.3241622190473 48.6829400446027,-72.3253290482697 48.6840511419324,-72.3257457236149 48.6850510739459,-72.3259680505579 48.6872732496956,-72.326773770766 48.6921896973559,-72.3280796760405 48.697467258549,-72.3292743344641 48.7020504700618,-72.3304134449275 48.7066891151246,-72.331663712951 48.7109389719349,-72.3329695369304 48.7128277257729,-72.333414146429 48.7150221131676,-72.3337198921874 48.7153554382211,-72.3337753841721 48.7180775349713,-72.334664548282 48.7200774749141,-72.3349702459612 48.7249939124571,-72.3351927069885 48.7282993132578,-72.3353872928251 48.7294937074228,-72.3352762351334 48.7325214328589,-72.3349152121579 48.7342713487157,-72.3347764733761 48.7388267187766,-72.3344155458942 48.7414655338917,-72.3339990724428 48.7429654812325,-72.3342213806239 48.7466041851889,-72.3346659493263 48.7474375057107,-72.3348327206844 48.7492707854465,-72.3349161298161 48.7499929785791,-72.3349439038062 48.751354040153,-72.3351107293087 48.7526595189911,-72.3352773519927 48.7547427954925,-72.335305221559 48.7582149446988,-72.3353332179752 48.7595760027171,-72.3354999412815 48.7617703254652,-72.3361666536071 48.7649090709647,-72.3371113119214 48.7659924312526,-72.337111327567 48.7666868159817,-72.3368612904731 48.7673256675946,-72.3365001524704 48.7682979150531,-72.3356945722271 48.7697145301284,-72.33444465993 48.770908945544,-72.333305679726 48.7720199852559,-72.3323891355368 48.7739366927623,-72.3307224886624 48.7757422569816,-72.3289448143733 48.7778534554622,-72.3267226717408 48.779214523512,-72.3250004045213 48.7803256853718,-72.3231948864492 48.7811591097701,-72.3215838639098 48.7815758011377,-72.3205837951156 48.7819369205336,-72.3196116864501 48.7831593122784,-72.3153339416157 48.7840482581687,-72.3125839077827 48.7860761766365,-72.3061394802745 48.7864372954681,-72.3048061030001 48.7873540843093,-72.3019728320001 48.7883541381526,-72.2994728363762 48.7899374571965,-72.2961116414032 48.7908819179403,-72.2943616280637 48.7913818846488,-72.2936671682398 48.7919652802389,-72.2930560379119 48.7934929969471,-72.2917504727748 48.7946041013446,-72.2903060611605 48.7979372937819,-72.2853059380012 48.7994373111159,-72.2832503992581 48.7996872557883,-72.2830559389216 48.8014094794094,-72.2809170015283 48.8026316238679,-72.2793892347628 48.8049092932331,-72.2768336666939 48.807231063221,-72.274092023706 48.8095486663813,-72.2766041172343 48.8097308013478,-72.2768175488865 48.8099490450262,-72.277043720305 48.810513139954,-72.2776563662539 48.8106861374933,-72.2778564111298 48.8149342905333,-72.2824104460337 48.8150801626445,-72.282597563523 48.8180841562259,-72.2860248192767 48.8186848855971,-72.2867048732482 48.8242459765777,-72.2929994366896 48.8377808474837,-72.3078820766276 48.8377920512973,-72.3078784047203 48.8378191658251,-72.3078913852629 48.8378733948761,-72.3079173463895 48.8379189144003,-72.3079707624113 48.8379642930562,-72.3080105577851 48.838046340772,-72.3081176036324 48.8381557845128,-72.3082648722375 48.8382650872698,-72.3083985206556 48.8383469938434,-72.3084919469246 48.8384378915667,-72.3085851602319 48.8384925427816,-72.30865198509 48.8385563259444,-72.3087322177593 48.8386201090522,-72.3088124506318 48.838702015296,-72.3089058782318 48.8389294697108,-72.309159347153 48.8392111522922,-72.309438781802 48.8394571505914,-72.3097463141657 48.8400303469563,-72.3103867139083 48.840330290137,-72.3106929784917 48.8404575725823,-72.3108262121867 48.8411129480372,-72.3115873165239 48.8420863793733,-72.3126679242219 48.8431324314867,-72.3138149855141 48.8433326212995,-72.3140418913632 48.8436147125678,-72.3143622445881 48.8439236365969,-72.3146683423608 48.8439872755792,-72.3147349688879 48.8440419232881,-72.3148018077777 48.8440881398997,-72.3149233487515 48.8441065424875,-72.3149637917375 48.844153178989,-72.3151262003918 48.8442352202055,-72.3152332709923 48.8443438150507,-72.3152988381091 48.8444982059527,-72.3154450803356 48.8448720248887,-72.3159404230783 48.8476740264554,-72.3190630032827 48.8488023313738,-72.3203446605762 48.8488842284239,-72.3204381258002 48.8492205284107,-72.320784530857 48.8507488834177,-72.3224929615381 48.8526594310631,-72.3246422704419 48.8527775674985,-72.3247621575722 48.8528416174016,-72.3248696831336 48.8529658282293,-72.3247032379648 48.8550449017076,-72.320456919696 48.8576162649313,-72.3151219134781 48.8605929491044,-72.3089998219873 48.8632960921671,-72.3034151318121 48.8659806921288,-72.2978030164794 48.8686304760678,-72.2923274586019 48.8695553787408,-72.2904165259091 48.8734021801879,-72.2945439607491 48.8749935712064,-72.2962236232466 48.8752936935357,-72.2965436428894 48.8761846376456,-72.297463047033 48.8762666951345,-72.297570155853 48.8845448585508,-72.3064890679967 48.8845853324283,-72.306333054855 48.8844767801702,-72.3061417245127 48.8843199775055,-72.3057636303976 48.8842456475846,-72.3055335772682 48.8841039993026,-72.3048823932633 48.8840639360048,-72.3044878862982 48.8840502791397,-72.3040382038048 48.8840725850678,-72.3035876635736 48.884104587941,-72.3032050746189 48.8841811205323,-72.3027805121942 48.8842847665554,-72.3023689376124 48.8843540047212,-72.3021081869339 48.8845465677405,-72.301599027606 48.884764967704,-72.3009801522034 48.8850640007101,-72.300332068661 48.8855387357536,-72.2992842982069 48.8871040352915,-72.2958783680767 48.8878169276335,-72.2943883836459 48.8885998733007,-72.2927193779615 48.8889683591355,-72.2918376764608 48.8895392001985,-72.290528300931 48.8900663592282,-72.2893426945414 48.8903182437886,-72.2887756681283 48.8905719769719,-72.288675842632 48.8908603716373,-72.2878778435526 48.8910005014774,-72.2875198544462 48.8911145174802,-72.2872443262895 48.8914230366502,-72.2866504024824 48.8914450676178,-72.2866245014474 48.8919654196356,-72.2855051212767 48.8920596274995,-72.2856120858971 48.8922784284727,-72.2858932019627 48.8926699249399,-72.2863474457172 48.8929707916156,-72.2867356944821 48.8933351681932,-72.2871769679184 48.894163678041,-72.2881389584067 48.8948831414824,-72.2889944979425 48.8958938904019,-72.2901840257986 48.8964857480527,-72.290879021293 48.8976053707452,-72.292161482918 48.8981058781701,-72.2927223206702 48.8982605825182,-72.2928959207248 48.8984516791386,-72.293109567143 48.8989705921942,-72.2937109026959 48.8996168031848,-72.2944455968779 48.8999263490621,-72.2948064565912 48.9001993595015,-72.2951136349599 48.9009274783446,-72.2959418854346 48.9012552865135,-72.2963296076358 48.9016557336478,-72.2967837978784 48.901919747822,-72.2970912133467 48.902475031415,-72.2977326833055 48.9025569465509,-72.2978262097253 48.9030300272516,-72.2983468906945 48.9030755511886,-72.2984003662838 48.9037307238954,-72.2991349652428 48.9039494924509,-72.2994162054804 48.9042949874029,-72.2997762655308 48.9048959211811,-72.3004849137278 48.9056514007114,-72.3013535913988 48.9059973149104,-72.3017545945128 48.9064067321321,-72.3022086558685 48.9068070148743,-72.3026493000389 48.907562619896,-72.3035316828759 48.908308802912,-72.3043733872732 48.9085362672188,-72.3046271816525 48.9086819628421,-72.3048010688091 48.9087456074069,-72.3048677672867 48.9088913026734,-72.305041655865 48.9090731034174,-72.3052283278978 48.909145880158,-72.3053084531156 48.9093007071685,-72.3054957701124 48.9095918130718,-72.3058162753744 48.910319573998,-72.3066175547606 48.9104923811281,-72.3068044519119 48.9108197300839,-72.3071513971234 48.9109470165022,-72.3072848058616 48.9112199942535,-72.3075921192992 48.9114747069536,-72.3078725825181 48.9120477728403,-72.3085002249287 48.912093433084,-72.3085673601918 48.9122486776246,-72.3087956210015 48.9122852056872,-72.3088493296328 48.9123488479495,-72.3089160380099 48.9123761030658,-72.3089426786567 48.9124123492854,-72.3089691055802 48.9124394635024,-72.3089821053062 48.9124468362121,-72.3089819300312 48.9135533261995,-72.3102580045374 48.9152407075954,-72.3122787476823 48.9189353634566,-72.3046391122913 48.9187189314399,-72.3039748025219 48.9185165990178,-72.3035429622112 48.9184053085192,-72.3032181175463 48.9183610610034,-72.3032874045257 48.9183009545849,-72.3035617592589 48.9182019111344,-72.3035504791636 48.9181188680753,-72.3033477745405 48.918053665236,-72.3031309984312 48.9180080018497,-72.3030638602915 48.9179082503292,-72.3029843690248 48.9178253479196,-72.3027953089566 48.917767435138,-72.3024146110895 48.9177737340806,-72.3021551904739 48.9177366360614,-72.3020469114047 48.9176366003942,-72.3019401378706 48.9175902276055,-72.3018047896314 48.9176120968679,-72.3013130196147 48.9176467848515,-72.3011893776897 48.9178153459367,-72.3009670105795 48.9178411843292,-72.300857225582 48.9178130761722,-72.3007487320834 48.9178115154695,-72.3005986656333 48.9178459188637,-72.3004477379073 48.9178704793965,-72.3002151708163 48.9179044564146,-72.300023315378 48.917874217715,-72.2997101859641 48.9179033643138,-72.2990544877991 48.9179645967864,-72.2988892695332 48.9181414338,-72.298598465268 48.918264465829,-72.2983225957257 48.9183336929919,-72.2980616619107 48.9183846529815,-72.2977738738944 48.9184634389691,-72.2975672931253 48.918496557875,-72.2972935782467 48.9185657826858,-72.297032641837 48.9186235957361,-72.2965399964054 48.9188248362825,-72.2960029639928 48.918904758694,-72.2959055200903 48.9189582776787,-72.2958632951361 48.9190205027821,-72.2957935685108 48.9190410635246,-72.295178997875 48.9190462055538,-72.2948104283548 48.9190350756468,-72.2946060040778 48.9189711400292,-72.2945120199066 48.9190393599395,-72.2941555783379 48.9190654771266,-72.2940730726763 48.9190898820339,-72.2938268543032 48.9190867423604,-72.2935267145283 48.9190583418346,-72.29339093717 48.919062192973,-72.2928995830854 48.9190335060682,-72.2927365207676 48.9189694261106,-72.2926288963343 48.9188060160043,-72.292482728551 48.9187507839923,-72.2923612455335 48.9186593019095,-72.2922133448064 48.9185294259005,-72.2918343884881 48.9185008804531,-72.291684971084 48.9185797984213,-72.2914920230223 48.9186231808651,-72.291340869973 48.9186664201018,-72.2911760740751 48.9187447650707,-72.2909285541452 48.918805842733,-72.2907496807393 48.9189281403127,-72.2904055752869 48.9189913637747,-72.2904313407018 48.9192341217986,-72.290425478184 48.9193059070014,-72.2904100983667 48.9193679856372,-72.2903267217586 48.919402375484,-72.2901757825146 48.9194010872736,-72.2900529974543 48.9193285864049,-72.290000163993 48.9193454232421,-72.2898905874275 48.919433329183,-72.2896974160517 48.9195273613658,-72.289231170395 48.9195794453155,-72.289052509536 48.9195777260736,-72.2888887956133 48.9195232067497,-72.288835528827 48.9194619888377,-72.2890007642953 48.9193899173094,-72.2889888606298 48.9193625144015,-72.2889485844974 48.9193500843702,-72.2886213755546 48.9192768662564,-72.2885003305171 48.9192132123929,-72.2884336392329 48.9192032179924,-72.288338357669 48.9192022145439,-72.2882428586213 48.919263431372,-72.2880776231096 48.9193076696244,-72.2880083215988 48.9193971497606,-72.2879652176142 48.9194687912132,-72.2879361914305 48.9195842405807,-72.2877969346466 48.9196291957227,-72.2877958466143 48.9196841457196,-72.2878900409205 48.9197126960894,-72.2880394595887 48.919759084962,-72.288174800484 48.9198218788018,-72.2881596348142 48.9199169086229,-72.2877888831433 48.9200039503559,-72.2875138483065 48.9200287716019,-72.2873085511964 48.9200007942108,-72.287213703754 48.919884054351,-72.2872301769291 48.9198914670354,-72.287079887284 48.9200220268365,-72.2866673330832 48.9200377119795,-72.2864486104171 48.9199600397379,-72.2859046365284 48.919912498967,-72.2856601540329 48.9198843765542,-72.2855516648624 48.9198448200915,-72.2852114648631 48.919831373121,-72.28478875377 48.9197919582197,-72.2844621976364 48.9197448458977,-72.2842586459289 48.9197077311587,-72.2841503761929 48.919598400483,-72.2840165672469 48.9195082026093,-72.2839914645244 48.9193011215208,-72.2839691996824 48.9191294290206,-72.2838914911174 48.9189386033537,-72.2837050786963 48.9187846049041,-72.2835996497155 48.9187122450605,-72.283560468848 48.9185032929061,-72.2833608534991 48.9183582851615,-72.2832552080622 48.9182752066948,-72.2830525371228 48.91808365973,-72.282797919098 48.9180281295825,-72.2826491639414 48.9179902932044,-72.2824726873046 48.9179253394633,-72.2822832243384 48.9177981687064,-72.282163503718 48.9174450697905,-72.2819401115843 48.9171118259314,-72.2818936327477 48.9167250682734,-72.2818893924435 48.9166089055849,-72.2819604447256 48.9165282746433,-72.2819896963208 48.9164482200221,-72.2820735155769 48.9163678771952,-72.2821300507278 48.9162694082421,-72.2821733809794 48.9161539656307,-72.282312641242 48.9160476578927,-72.282465324155 48.916030251975,-72.2825203285379 48.9160134220934,-72.2826299001779 48.9158611508391,-72.2826881818974 48.915663348456,-72.282692988751 48.9155176199908,-72.282519142653 48.915282989369,-72.2824429744476 48.9150310968451,-72.2824354518043 48.9145816899713,-72.2824600197776 48.914303112418,-72.282480435378 48.9140783369383,-72.2824858983402 48.9138989486138,-72.282531192404 48.9137291273261,-72.2826308324408 48.9135780079406,-72.2827982406615 48.913426168444,-72.2828974422625 48.9131657167511,-72.2829310590269 48.9130404183048,-72.282988681104 48.9129243987577,-72.2830733664501 48.9125844671706,-72.2832453563942 48.9123170391241,-72.2834701605621 48.9121290909827,-72.2835565900294 48.9119504215564,-72.2836700819891 48.9115827965629,-72.2837745160798 48.911377873052,-72.2839568635688 48.9111201535906,-72.284249642739 48.9109686003006,-72.2843761158776 48.910843301036,-72.2844337317251 48.9106826127219,-72.2845467813327 48.9106019809815,-72.2845760251404 48.9105381811081,-72.2844957098869 48.9105096263379,-72.2843463205911 48.9104461139175,-72.2842932864121 48.9103917363133,-72.2842536744942 48.910238744975,-72.2842437431358 48.910076474978,-72.2842067495709 48.9098483910868,-72.2838984804531 48.909810556792,-72.2837220315376 48.909808974126,-72.2835719899954 48.9097628678268,-72.2834639604258 48.9096718062819,-72.2833570226923 48.9095180952829,-72.2832788938795 48.909040707172,-72.2832086261632 48.9083488296118,-72.2832663579169 48.9078360529841,-72.283251523524 48.9075022333927,-72.2831504856459 48.9071875472674,-72.2831581277372 48.9069621957205,-72.283109028842 48.9068268984161,-72.2830713861129 48.9066918889836,-72.2830610221575 48.9065845723382,-72.2831181994738 48.9064250364668,-72.2833403571506 48.9060437453894,-72.283854391393 48.9056774141799,-72.2840815621762 48.9055976453308,-72.2841926376374 48.9054478172116,-72.284482764178 48.9054214191612,-72.2845379742557 48.9050481076103,-72.2849562991009 48.9048927743331,-72.2850655203552 48.9041412633533,-72.2850655647102 48.9141511712023,-72.2656468385899 48.9160179557695,-72.267824255439 48.9258010192052,-72.2484494161225 48.9294859298643,-72.2531741347832 48.9297491481569,-72.2530650918442 48.9300208268852,-72.25296441934 48.930274351889,-72.2527984086204 48.9306090658653,-72.2526305098961 48.9309024172638,-72.252388431353 48.9312247187817,-72.2521456283588 48.9313616635872,-72.2519356976411 48.9315162526714,-72.251744025744 48.9316326307724,-72.2517693787391 48.9318028704707,-72.2519435350915 48.9319794858582,-72.2521833252358 48.9321208880967,-72.252377039483 48.9323467932746,-72.2523431545746 48.9325655239345,-72.2521781365248 48.9328351816628,-72.2518990990267 48.9330413975979,-72.2516497595113 48.9332246203741,-72.251419828458 48.9334381157929,-72.2513113088835 48.9336445343337,-72.2510807960423 48.9337626996882,-72.2507397329389 48.9337762773279,-72.2503825781795 48.9337955577333,-72.2500206397583 48.9338458614256,-72.249840975476 48.9339713042099,-72.249640596752 48.9341384034495,-72.2495330903562 48.9342885586077,-72.249463681435 48.934385356443,-72.2492922719051 48.934452909227,-72.2491027549712 48.9344843434581,-72.2487921057873 48.9345973594017,-72.2485075364316 48.934740141373,-72.2482974354375 48.9348667027604,-72.2482003554207 48.9349525108023,-72.2480854563994 48.9349678137714,-72.2478879602421 48.9349075916212,-72.2476922168812 48.9347830132477,-72.2474418443238 48.9345942799237,-72.2471554034581 48.9345272837186,-72.2468660537681 48.934452797209,-72.2464171829991 48.9343796479721,-72.246099732984 48.934208060409,-72.2457941689442 48.9341928880165,-72.2454658497211 48.9341454056095,-72.2448378976717 48.9342140943026,-72.2442164512322 48.9343355037253,-72.2431101845962 48.9343275206676,-72.242377907558 48.9341332584451,-72.241594074076 48.9339184583967,-72.2410548294214 48.9332945543762,-72.2402442812538 48.9329293817422,-72.2397463743545 48.9327866251547,-72.2394306963377 48.9327456734034,-72.2388683955032 48.9328511815451,-72.2379080574584 48.9330267701222,-72.2369833481559 48.9335009078217,-72.2357694924032 48.9341475629039,-72.2344198000336 48.9345314658798,-72.2334429629404 48.9348356312413,-72.2326090028749 48.9350242201617,-72.2318153632514 48.9352044216401,-72.2313225162569 48.9354549199967,-72.2308842605682 48.9358229346087,-72.2305744767739 48.9366748511244,-72.2299518184095 48.9377022753434,-72.2294562812922 48.9386378430609,-72.229047559049 48.9406988891381,-72.2286195142385 48.9419380611142,-72.228381472633 48.9429706533674,-72.2283552344115 48.9437263661856,-72.2284862128677 48.9444127876406,-72.2286377968187 48.9450909231729,-72.2290902407053 48.9456175705194,-72.2294901541859 48.9460743304411,-72.2298730080043 48.9469188507643,-72.2306780346943 48.9475873566501,-72.2313186510322 48.9480222426152,-72.2318147369392 48.9483652852937,-72.2324072356934 48.9487205409102,-72.2330556888688 48.9489811523402,-72.2335375057125 48.9494027825147,-72.2338837607456 48.9498007135061,-72.2341930710425 48.9502320855073,-72.2343700456572 48.9506535065561,-72.2346974778057 48.9513443620096,-72.2352623906106 48.9519762845001,-72.235734860486 48.9525045546647,-72.2362850648371 48.9529866360348,-72.2368552914723 48.9532877794262,-72.2372128362722 48.9536824371694,-72.237100593303 48.9588011767644,-72.2274252147659 48.9581613379954,-72.226471645222 48.9662541545455,-72.2102025188549 48.9558207808209,-72.1972933508185 48.9530682314994,-72.199631782562 48.9450553609454,-72.1902560755898 48.9392966839424,-72.183539247145 48.9383583109677,-72.1820916864734 48.9399660832726,-72.1810011549342 48.9412440562898,-72.1803346903032 48.9416329940241,-72.1801125492797 48.9420775134372,-72.1795293315915 48.9423276355381,-72.1789183324163 48.9424387577809,-72.1782794606597 48.9423554932386,-72.1773628410127 48.9419666271571,-72.1761405728562 48.9416888281432,-72.1752794923148 48.9417721991141,-72.1747239526545 48.9419666817121,-72.1744462989261 48.9423556302133,-72.1740852616594 48.9438003641229,-72.1730022558615 48.944856086299,-72.1724469701419 48.9460784814578,-72.1715584578708 48.9469675205019,-72.1710864618674 48.9479399321461,-72.1704199836792 48.9489679707973,-72.1693370431623 48.9497737069147,-72.1683651155465 48.9499959240155,-72.1681151918645 48.9525241780537,-72.1651712416465 48.9529409076047,-72.1645323795278 48.9541075784968,-72.1626434979562 48.9548854710015,-72.1615322679165 48.9558021584163,-72.1599211537885 48.9563855190361,-72.1587265655117 48.9575244461696,-72.1571432526829 48.9579689707606,-72.1568098354033 48.9585801603975,-72.1565321625756 48.9608303682739,-72.1557825506031 48.9616916239349,-72.1556715806723 48.9628861902845,-72.155477344993 48.9636918658524,-72.155227450421 48.9647475569628,-72.1551165610205 48.9649975535827,-72.155061075338 48.9658865791587,-72.1548945625418 48.9683034905464,-72.1540893224221 48.9699703644375,-72.1538396835193 48.9714982116392,-72.1533675522811 48.9728039302163,-72.1531733658994 48.9740540458094,-72.1527846279413 48.9749153090911,-72.1524514361536 48.9763320981073,-72.1518960012759 48.9779155613544,-72.1516740422727 48.9791102133189,-72.1516187232975 48.9811659788707,-72.1512024120442 48.981860471211,-72.1510358297713 48.9833050548821,-72.1503969935008 48.984277295211,-72.1502028036265 48.9850274539466,-72.1500361953346 48.9862775780994,-72.1500641841865 48.9873332950014,-72.1502866849737 48.9879445014175,-72.1503424619155 48.9890278960818,-72.1501481176224 48.9905836388665,-72.1503706521482 48.9922227986524,-72.1504821630646 48.9939174393359,-72.1504546944972 48.9945564139052,-72.1504549248501 48.9952231823892,-72.150593944699 48.9966400843277,-72.1512332970835 48.9970568441322,-72.1515112483334 48.9978625226459,-72.1516781110325 48.9987793237911,-72.151872869002 48.9998628517637,-72.1524287613765 49.0030297900151,-72.153873703226 49.0053354557433,-72.1547350786132 49.0061410898108,-72.1549294961974 49.007446695205,-72.1550962354024 49.0078910864211,-72.1549295146476 49.0081966567055,-72.1547349521432 49.0084743428137,-72.1541236362063 49.0086408351345,-72.1527621921346 49.0088074150073,-72.1518174215538 49.0091128685912,-72.1510671192348 49.0091962103677,-72.1508726549048 49.0093413697819,-72.1506273038835 49.0088675800909,-72.1500793335749 49.0087941918546,-72.1499945085021 49.0087043450615,-72.1499019262976 49.0067780018604,-72.1476761472867 49.0052488549737,-72.1460333059459 49.0044180422968,-72.1451051150272 49.0030572095417,-72.1436380161149 49.0009449943195,-72.141264009799 49.000902795891,-72.1412164976465 48.9941053892588,-72.133578011657 48.9914744768975,-72.1306187102334 48.9903563247693,-72.1293602707091 48.9893091233546,-72.1281781049989 48.989306927753,-72.1281825382302 48.9883852485854,-72.127135400498 48.9863211368565,-72.1248199349145 48.9821765473209,-72.1201259415117 48.9775976600693,-72.1149380161885 48.9775802458355,-72.1149182786362 48.9762139462364,-72.1133658977145 48.9709543922972,-72.1073725100816 48.9659605039503,-72.1016801316322 48.9658871724768,-72.1015955839154 48.962403168598,-72.0975749543055 48.961054193607,-72.0960174222539 48.9556470171274,-72.0898020994019 48.9547604065777,-72.0887763996257 48.9543880231499,-72.0883454090732 48.9543664970298,-72.0883207530907 48.9543089363821,-72.0882543710803 48.9539634801377,-72.0878559482406 48.9538913225358,-72.0877726365171 48.9537397113038,-72.0875977532167 48.9536603442204,-72.0875059061313 48.9535592692736,-72.0873892727169 48.9534654917581,-72.0872810367596 48.9523754565446,-72.0860228878618 48.9521675543801,-72.0857828317513 48.9520289837493,-72.085622885605 48.9519423191317,-72.0855227847952 48.9436841551304,-72.0759932297092 48.942636027742,-72.0748106925435';
        $test = explode(' ', $test);

        $test = array_map(function ($item) {
            return explode(',', $item);
        }, $test);

        error_log(var_export(count($test), true));
        $test = $this->polylineOptimizer()->optimizePath($test);
        error_log(var_export(count($test), true));

        $encoded = $this->polylineEncoder()->Encode($test);
        error_log(var_export(urlencode($encoded), true));
    }

    /**
     * @return PolylineOptimizerService
     */
    public function polylineOptimizer()
    {
        return $this->polylineOptimizer;
    }

    /**
     * @param mixed $polylineOptimizer PolylineOptimizer for StaticMapGeneratorService.
     * @return self
     */
    public function setPolylineOptimizer($polylineOptimizer)
    {
        $this->polylineOptimizer = $polylineOptimizer;

        return $this;
    }

    /**
     * @return \Polyline
     */
    public function polylineEncoder()
    {
        return $this->polylineEncoder;
    }

    /**
     * @param mixed $polylineEncoder PolylineEncoder for StaticMapGeneratorService.
     * @return self
     */
    public function setPolylineEncoder($polylineEncoder)
    {
        $this->polylineEncoder = $polylineEncoder;

        return $this;
    }
}
